name: Core-API | Nightly Builder

on:
  push:
    branches:
      - testing

  workflow_dispatch:
    inputs:
      version:
        description: 'Version to build'
        required: true
        type: string

jobs:
  get-version:
    name: Get version
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.set-version-push.outputs.version || steps.set-version.outputs.version }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set short commit hash on push
        if: github.event_name == 'push'
        id: set-version-push
        run: echo "version=$(git rev-parse --short HEAD)" >> "$GITHUB_OUTPUT"
      - name: Set version from input
        if: github.event_name == 'workflow_dispatch'
        id: set-version
        run: echo "version=${{ github.event.inputs.version }}" >> "$GITHUB_OUTPUT"

  build-nightly:
    name: Build Nightly version
    needs: get-version
    uses: ./.github/workflows/build.yml
    with:
      version: ${{ needs.get-version.outputs.version }}
